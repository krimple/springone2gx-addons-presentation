<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>Leap ahead with Roo Add-ons</title>

  <meta name="viewport" content="width=device-width"/>

  <link rel="stylesheet" href="./css/reset.css" type="text/css"/>
  <link rel="stylesheet" href="./css/showoff.css" type="text/css"/>

  <link type="text/css" href="./css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href="./css/sh_style.css" rel="stylesheet" />

  <script type="text/javascript" src="./js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src="./js/jquery-print.js"></script>
  <script type="text/javascript" src="./js/jquery.batchImageLoad.js"></script>

  <script type="text/javascript" src="./js/jquery.doubletap-0.1.js"></script>

  <script type="text/javascript" src="./js/fg.menu.js"></script>
  <script type="text/javascript" src="./js/showoff.js"></script>
  <script type="text/javascript" src="./js/jTypeWriter.js"> </script>
  <script type="text/javascript" src="./js/sh_main.min.js"></script>
  <script type="text/javascript" src="./js/core.js"></script>
  <script type="text/javascript" src="./js/showoffcore.js"></script>
  <script type="text/javascript" src="./js/coffee-script.js"></script>

  
    
      <script type="text/javascript" src="./js/sh_lang/sh_java.min.js"></script>
    
      <script type="text/javascript" src="./js/sh_lang/sh_xml.min.js"></script>
    
  

  
    <link rel="stylesheet" href="./file/sh_ide-eclipse.css" type="text/css"/>
  
    <link rel="stylesheet" href="./file/springone.css" type="text/css"/>
  

  
    <script type="text/javascript" src="./file/springone.js"></script>
  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>

<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
    <tr><td class="key">P</td><td>toggle pause</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso">loading presentation...</div>
<div id="footer">
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
</div>

<div id="slides" class="offscreen" style="display:none;">
<div class="slide" data-transition="none"><div class="content full-screen" ref="title-page/title-page">
<p><img src="./file/title-page/title-image.png" width="1440" height="900" style="width: 100%;height: 100%;"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="about-me/slides">
<h1>About me - Ken Rimple (@krimple)</h1>

<ul>
<li>Co-Author, Spring Roo in Action w/Srini Penchikala</li>
<li>Host Silly Weasel Roo add-ons project (<a href="http://rimple.com/silly-weasel-forge">rimple.com/silly-weasel-forge</a>)</li>
<li><p>Director of Education Services, Chariot Solutions</p>

<ul>
<li>Certified instructor, mentor, consultant</li>
<li>I run <a href="http://chariotsolutions.com/education">chariotsolutions.com/education</a></li>
<li>Podcasts, screencasts, etc., at <a href="http://emergingtech.chariotsolutions.com">emergingtech.chariotsolutions.com</a></li>
<li>Chariot is a VMWare Authorized Training Center</li>
<li>We teach Spring, Maven, other courseware</li>
<li>We also develop in Spring, Java, mobile, integration technologies</li>
</ul></li>
<li><p>More about me at my blog <a href="http://www.rimple.com/about-me">rimple.com/about-me</a></p></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="about-roo/slides/1">
<h1>What is Spring Roo?</h1>

<ul>
<li><p>Command-Line Shell</p></li>
<li><p>Configures Projects</p></li>
<li><p>Provides maven-based builds</p></li>
<li><p>Generates code smartly</p></li>
<li><p>Geared toward Spring projects</p></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/2">
<h1>Set up a Spring Project</h1>

<pre class="sh_java"><code>roo&gt; project --topLevelPackage org.foo 
   --projectName conference-planner

roo&gt; jpa setup --database HYPERSONIC_PERSISTENT
    --provider HIBERNATE</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/3">
<h1>Set up JPA Entities</h1>

<pre class="sh_java"><code>roo&gt; entity jpa --class ~.model.Conference 
    --testAutomatically

roo&gt; entity jpa --class ~.model.Registration 
    --testAutomatically</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/4">
<h1>Set up Conference Fields</h1>

<pre class="sh_java"><code>roo&gt; focus --class ~.model.Conference

roo&gt; field string --fieldName conferenceName

roo&gt; field date --fieldName startDate
     --type java.util.Date

roo&gt; field set --fieldName registrations 
     --type ~.model.Registration
     --cardinality ONE_TO_MANY --mappedBy conference</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/5">
<h1>Set up Registration Fields</h1>

<pre class="sh_java"><code>roo&gt; focus --class ~.model.Registration

roo&gt; field string --fieldName firstName

roo&gt; field string --fieldName lastName

roo&gt; field reference --fieldName conference
   --type ~.model.Conference
   --cardinality MANY_TO_ONE</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/6">
<h1>Set up Web MVC</h1>

<pre class="sh_java"><code>roo&gt; web mvc setup

roo&gt; web mvc all --package ~.web</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/7">
<p><img src="./file/about-roo/sample-application.png" width="805" height="292"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/8">
<h1>Roo can configure...</h1>

<div class="tagcloud">
      Functional Maven build * Spring Framework&#x2002;* 
      JPA 2.0&#x2002;* Bean Validators&#x2002;* 
      Hibernate, OpenJPA, EclipseLink or Data Nucleus&#x2002;* 
      JPA Providers&#x2002;* Spring Services&#x2002;* 
      Spring Repositories and Spring Data JPA&#x2002;* 
      NoSQL with MongoDB and Spring Data JPA MongoDB&#x2002;* 
      Spring JMS w/ActiveMQ&#x2002;* Email Support&#x2002;* 
      Spring MVC&#x2002;* Solr searching&#x2002;* 
      JSF w/Mojarra * GWT w/MVP&#x2002;or MyFaces&#x2002;* 
      Tiles layouts&#x2002;and theming&#x2002;* Localization&#x2002;* 
      Your pick of RDBMS&#x2002;* Reverse Engineering&#x2002;* 
      Functional Maven build&#x2002;* Logging w/SLF4J&#x2002;* 
      Selenium Web Testing&#x2002;* Persistence JUnit Tests...
</div>      
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="about-roo/slides/9">
<h1>These are installed via Roo Add-Ons</h1>

<ul>
<li><p>Java-based recipes</p></li>
<li><p>Some installed with Roo, others are downloadable</p></li>
<li><p>You can go further... and write your own add-ons!</p></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="what-are-add-ons/slides/1">
<h1>What are Roo Add-Ons?</h1>

<ul>
<li>Components that can add commands and behavior to a running Roo Shell

<ul>
<li>OSGi bundle (JAR) projects</li>
<li>Created in Roo itself</li>
<li>Built using Maven</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="what-are-add-ons/slides/2">
<h1>Can be installed in a variety of ways</h1>

<ul>
<li>Locally via JAR

<ul>
<li><code>roo&gt; osgi start --url</code> <em><code>path</code></em></li>
</ul></li>
<li>Object Bundle Repository

<ul>
<li><code>osgi obr</code> command set</li>
</ul></li>
<li>Roo public add-on registry

<ul>
<li><code>addon</code> command set</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="what-are-add-ons/slides/3">
<h1>Add-on Project Types</h1>

<ul>
<li>Four types of add-ons available

<ul>
<li>Simple</li>
<li>Advanced</li>
<li>i18n</li>
<li>wrapper</li>
</ul></li>
<li>We'll focus on the simple and advanced ones</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="what-are-add-ons/slides/4">
<h1>Simple add-ons</h1>

<pre class="sh_java"><code>roo&gt; addon create simple --projectName simpleaddon
     --topLevelPackage org.foo.bar</code></pre>

<ul>
<li>Modifies files in your project structure</li>
<li>Example add-on: jQuery add-on</li>
<li>Features used: modifies mvc tags and adds jQuery library</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="what-are-add-ons/slides/5">
<h1>Advanced add-ons</h1>

<pre class="sh_java"><code>roo&gt; addon create advanced --projectName advancedaddon
     --topLevelPakage org.foo.bar</code></pre>

<ul>
<li>Adds maven manipulation, base class for re-use of framework</li>
<li>Example: CoffeeScript add-on</li>
<li>Features used: transactional file copy, maven build configuration changes</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="what-are-add-ons/slides/6">
<h1>i18n add-ons</h1>

<ul>
<li>Creates a new language bundle</li>
<li>The language bundle can be installed</li>
<li>Adds support for additional languages</li>
<li>Example: support the Norwegian language</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="what-are-add-ons/slides/7">
<h1>wrapper add-ons</h1>

<ul>
<li>Builds an OSGi-compliant JAR</li>
<li>Wraps an existing Maven JAR's contents</li>
<li>Allows the JAR to be loaded into the Roo shell at runtime</li>
<li>This may be required for JDBC drivers, other features needed by shell add-ons</li>
<li>Example: Wrapper around JDBC Driver for DBRE</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="what-are-add-ons/slides/8">
<h1>Add-on API key features</h1>

<ul>
<li>Injecting Shell commands</li>
<li>Providing Events to other Shell add-ons</li>
<li>Subscribe to and publish to the Meta-Data Service</li>
<li>Write, edit, and manipulate ITDs and Java classes</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="what-are-add-ons/slides/9">
<h1>What are ITDs?</h1>

<ul>
<li><p>Inter-Type Declarations</p>

<ul>
<li>AspectJ-generated class fragments</li>
<li>Woven into existing classes</li>
</ul></li>
<li><p>Separates features from boilerplate</p></li>
<li><p>100% compile-time - no runtime component</p></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="what-are-add-ons/slides/10">
<h1>Sample ITD</h1>

<pre class="sh_java"><code>privileged aspect Course_Roo_ToString {

    public String Course.toString() {
        return ReflectionToStringBuilder
           .toString(this, 
                     ToStringStyle.SHORT_PREFIX_STYLE);
    }
}</code></pre>

<ul>
<li>Generated by shell via <code>@RooToString</code> on entity</li>
<li>Generation done via ToString add-on</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="what-are-add-ons/slides/11">
<h1>Injecting Commands</h1>

<p><img src="./file/what-are-add-ons/inject-commands.jpg" width="1172" height="694" class="diagram"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="what-are-add-ons/slides/12">
<h1>Roo Metadata Service</h1>

<p><img src="./file/what-are-add-ons/roo-metadata.jpg" width="1089" height="687" class="diagram"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="why-addons/slides/1">
<h1>Why write addons?</h1>

<ul>
<li>Replace the Maven archetype system</li>
<li>Provide implementation patterns in live projects</li>
<li>Generate and separate boilerplate code</li>
<li>Achieve a RAD platform with your own code patterns</li>
<li>Share with others &#x2013; re-use of your own conventions</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets incremental" ref="why-addons/slides/2">
<h1>Tip: Build a Library of Recipe commands</h1>

<ul>
<li>Your preferred ORM strategy / persistence mechanism</li>
<li>Your web framework configuration</li>
<li>Your set of standard libraries</li>
<li>An Ajax approach</li>
<li>Javascript, CSS, bootstrap libraries</li>
<li>Anything you can think of...</li>
<li>Share it with the outside world!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="mechanics/slides/1">
<h1>What are Roo Add-ons?</h1>

<ul>
<li>Add-ons are OSGi bundles</li>
<li>To understand this we have to detour</li>
<li>What is OSGi in the context of Roo?</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="mechanics/slides/2">
<h1>OSGi in 5 minutes (really)</h1>

<ul>
<li>OSGi - dynamic module loading system

<ul>
<li><code>Bundle</code> = Jar w/instructions (<code>META-INF/MANIFEST.MF</code>  )</li>
<li><code>OSGi Container</code> - a runtime platform (Apache Felix)</li>
<li><code>OSGi Shell</code> - command line exposed by container</li>
</ul></li>
<li>Roo uses OSGi to mount and expose commands</li>
<li>Roo does <em>not</em> use OSGi in production</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content full-screen" ref="mechanics/slides/3">
<h1>OSGi's dreaded <code>META-INF/MANIFEST.MF</code></h1>

<p><img src="./file/mechanics/manifest-created.jpg" width="921" height="560" class="diagram"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content full-screen" ref="mechanics/slides/4">
<h1>Roo and OSGi bundles</h1>

<p><img src="./file/mechanics/roo-bundles.jpg" width="858" height="441" class="diagram"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="simple-addons/slides/1">
<h1>Simple add-ons - jQuery / jQuery UI</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="simple-addons/slides/2">
<h1>jQuery add-on features</h1>

<ul>
<li>Installs the jQuery Javascript library</li>
<li><p>Installs jQueryUI and associated images and theme files</p></li>
<li><p>Exposed by two commands</p>

<ul>
<li><code>jquery setup</code> - sets up jQuery</li>
<li><code>jqueryui setup</code> - installs jQuery UI</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="simple-addons/slides/3">
<h1>Creating the add-on</h1>

<pre class="sh_java"><code>$ mkdir jquery-addon
$ cd jquery-addon
$ roo
...
roo&gt; addon simple create 
    --projectName jqueryaddon
    --topLevelPackage org.sillyweasel.addons</code></pre>

<ul>
<li>Let's review the files Roo created...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content full-screen" ref="simple-addons/slides/4">
<h1>Files created by the <em>simple</em> add-on</h1>

<p><img src="./file/simple-addons/addon-files.jpg" width="804" height="603" class="diagram"/></p>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="simple-addons/slides/5">
<h1>Let's do something simple...</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/6">
<h1>Installing a simple command</h1>

<ul>
<li>Expose a dummy <code>jquery setup</code> command</li>
<li>Echo a success message to the Roo shell</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/7">
<h1>Create a <em>command</em> OSGi Component</h1>

<pre class="sh_java"><code>@Component
@Service
public class JqueryaddonCommands
  implements CommandMarker {

   private Logger log =
     Logger.getLogger(getClass().getName());

   @CliCommand(value = "jquery setup", 
                help = "Setup jQuery")
   public void sayHello() {
     log.severe("jQuery installed.");
   }

}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/8">
<h1>Run the example</h1>

<pre class="sh_java"><code> roo&gt; quit

 $ mvn clean package

 Build successful.

 $ roo

 roo&gt; osgi start --url (full path to jar in ./target)   
 roo&gt; jquery setup

 jQuery installed.</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="simple-addons/slides/9">
<h1>Refactor - Delegate to another component</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/10">
<h1>Add an Operations interface</h1>

<pre class="sh_java"><code> package org.sillyweasel.jqueryaddon;
 public interface JqueryaddonOperations {
    void setup();
 }</code></pre>

<ul>
<li>Interface driven components, just like Spring</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/11">
<h1>The implementation class</h1>

<p class="notes"><code>@Component</code> and <code>@Service</code> expose this bean, `@Reference' injects another bean_</p>

<pre class="sh_java"><code>package org.sillyweasel.addons.jquery;
...
@Component
@Service
public class JqueryOperationsImpl
  extends AbstractOperations 
  implements JqueryOperations {

  @Reference 
  private ProjectOperations projectOperations;

  public void setup() {...}

}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/12">
<h1>The <code>setup()</code> method in detail</h1>

<pre class="sh_java"><code>public void setup() {

   String pathIdentifier = 
      pathResolver.getFocusedIdentifier(
        Path.SRC_MAIN_WEBAPP, "js");

   copyDirectoryContents("jquery-1.8.1.min.js",
      pathIdentifier, true);

}</code></pre>

<ul>
<li><code>copyDirectoryContents</code> is a method of <code>AbstractOperations</code></li>
<li>We manually changed our bean to extend this class</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/13">
<h1>Stage the asset(s)</h1>

<pre><code>src/main/resources *
          &#x2514;&#x2500;&#x2500; org
              &#x2514;&#x2500;&#x2500; sillyweasel
                 &#x2514;&#x2500;&#x2500; addons
                      &#x2514;&#x2500;&#x2500; jquery
                        &#x2514;&#x2500;&#x2500; jquery-1.8.1.min.js
</code></pre>

<p><em>Made available in JAR for copying into project</em></p>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="simple-addons/slides/14">
<h1>OSGi's SCR API makes delegation easy</h1>

<ul>
<li>Expose components via <code>@Component</code> and <code>@Service</code>

<ul>
<li><code>@Component</code> provides lifecycle</li>
<li><code>@Service</code> provides component for injection</li>
</ul></li>
<li>Inject delegate with <code>@Reference</code></li>
<li>Sounds vaguely familiar...</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="simple-addons/slides/15">
<h1>Injection and calling <code>JqueryaddonOperations.setup()</code></h1>

<pre class="sh_java"><code>@Component
@Service
public class JqueryaddonCommands 
   implements CommandMarker {

   @Reference 
   private JqueryaddonOperations addonOperations;

   @CliCommand(value = "jquery setup", 
                help = "Setup jQuery")
   public void setup() {         
      // call delegate
      addonOperations.setup();          
   }
}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="simple-addons/slides/16">
<h1>What else can you do with Roo Components/Services</h1>

<ul>
<li>Inject services from other bundles...

<ul>
<li>More complex with non--core-Roo components</li>
<li>Must wrestle with dependencies and/or MANIFEST entries</li>
<li>Not covered here - we will inject standard Roo services</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="simple-addons/slides/17">
<h1>Diversion - the Roo source code</h1>

<p>(See http://github.com/springsource/spring-roo)  </p>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="addon-command-annotations/slides/1">
<h1>CLI command annotations</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/2">
<h1>Key annotations</h1>

<ul>
<li><code>@CliAvailabilityIndicator</code> - Is the command (or list of commands) available?</li>
<li><code>@CliCommand</code> - Expose a command to the shell</li>
<li><code>@CliOption</code> - Expose command-line options for the given command</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/3">
<h1>Example - Command with Parameters</h1>

<pre class="sh_java"><code>@CliCommand(value = "coffeescript addjoinset", ...) 
public void addJoinSet(

  // one for each option...
  @CliOption(
    key = "joinSetId", 
    mandatory = true, 
    specifiedDefaultValue = "main") String joinSetId,

  ...) {

   operations.addJoinSet(joinSetId, ...);

}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/4">
<h1>Picking sets of options</h1>

<pre class="sh_java"><code>@CliCommand(value = "say hello", 
   help = "Prints welcome message to the Roo shell")
public void sayHello(      
  @CliOption(key = "name", 
             mandatory = true, 
             help = "State your name") String name, 

  @CliOption(key = "countryOfOrigin", 
             mandatory = false, 
             help = "country") Country country) {...}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/5">
<h1>The <code>Country</code> enum</h1>

<pre class="sh_java"><code>public enum Country {
  AUSTRALIA("Australia"),
  UNITED_STATES("United States"),
  GERMANY("Germany"), ...

  private String countryText;

  private Country(String value) {
      Validate.notBlank(propertyName, 
         "Property name required");
      this.value = value;
  }
  public String toString() {
      return value;
  }
}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="addon-command-annotations/slides/6">
<h1>Dynamic attribute fill-in</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content bullets" ref="addon-command-annotations/slides/7">
<h1>Key Components</h1>

<ul>
<li><p>Converters</p>

<ul>
<li>Convert from text in the Roo Shell to Java types, <em>and</em></li>
<li>Provides list of possible completion values, based on text entered so far</li>
<li>Similar to Spring converters, but not the same</li>
</ul></li>
<li><p>Target datatypes as Shell <code>@CliOption</code> param types</p>

<ul>
<li>Built-in converters selected automatically</li>
<li>Your converter must be registered as a <code>@Component</code> and <code>@Service</code></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/8">
<h1>The Roo Converter interface</h1>

<pre class="sh_java"><code>public interface Converter&lt;T&gt; {
  T convertFromText(String value, Class&lt;?&gt; targetType, 
                    String optionContext);

  boolean getAllPossibleValues(
    List&lt;Completion&gt; completions,
    Class&lt;?&gt; targetType,
    String existingData, 
    String optionContext, 
    MethodTarget target);

  boolean supports(Class&lt;?&gt; type, String optionContext);
}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/9">
<p class="notes">This one does not use the option context data</p>

<h1>Built-in - BooleanConverter - <code>convertFromText</code></h1>

<p class="notes">Makes the input more flexible</p>

<pre class="sh_java"><code>public Boolean convertFromText(
  final String value,
  final Class&lt;?&gt; requiredType, 
  final String optionContext) {

    if ("true".equalsIgnoreCase(value) 
        || "1".equals(value)
        || "yes".equalsIgnoreCase(value)) {
        return true;
    }
    else if ("false".equalsIgnoreCase(value) 
         || "0".equals(value)
         || "no".equalsIgnoreCase(value)) {
        return false;
    }
  ...</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/10">
<h1>Dealing with type conversion issues</h1>

<pre class="sh_java"><code>... else {
      throw new IllegalArgumentException(
         "Cannot convert " + value
         + " to type Boolean.");
    }
  }</code></pre>

<ul>
<li>Exception will appear as output in the shell</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/11">
<h1>Command Option Context</h1>

<p class="notes">Show them</p>

<pre class="sh_java"><code>// in @CliOption
@CliOption(... optionContext = "path-a")

// in converter...
if (optionContext.equals("path-a")) {
  ... do something
}</code></pre>

<ul>
<li>set context with <code>optionContext</code> on <code>@CliOption</code> </li>
<li>converter can distinguish between multiple commands</li>
<li>may need to convert differently based on the source</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/12">
<h1>Converters built-in for</h1>

<ul>
<li>Java Datatypes

<ul>
<li><code>BigDecimal</code>, <code>BigInteger</code>, <code>Boolean</code>, <code>Character</code>, <code>Date</code>, <code>Double</code>, <code>Float</code>, <code>Integer</code>, <code>Long</code>, <code>Short</code>, <code>String</code></li>
</ul></li>
<li>Files

<ul>
<li>The <code>FileConverter</code> can do completions based on files in the directory</li>
</ul></li>
<li>Other key converters

<ul>
<li><code>Locale</code>, <code>Static Fields</code>, <code>Enum</code></li>
</ul></li>
<li>Available Commands 

<ul>
<li>via <code>AvailableCommandsConverter</code></li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/13">
<h1>Example - PgpKeyIdConverter</h1>

<p class="notes">Shows how a service can be accessed by the converter</p>

<pre class="sh_java"><code>@Component
@Service
public class PgpKeyIdConverter 
  implements Converter&lt;PgpKeyId&gt; {

  @Reference 
  private PgpService pgpService;

  public PgpKeyId convertFromText(
          final String value,
          final Class&lt;?&gt; requiredType, 
          final String optionContext) {
      return new PgpKeyId(value.trim());
  }
  ...</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/14">
<h1>Example - PgpKeyIdConverter - code fill-in</h1>

<pre class="sh_java"><code>  public boolean getAllPossibleValues(...) {

    for (final PgpKeyId candidate : 
            pgpService.getDiscoveredKeyIds()) {
        final String id = candidate.getId();
        if (id.toUpperCase().startsWith(
          originalUserInput.toUpperCase())) {
            completions.add(new Completion(id));
        }
    }
    return false; // can we dig deeper next time?
}</code></pre>

<ul>
<li>The pgpService is an OSGi Roo service from the add-on</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="addon-command-annotations/slides/15">
<h1>What about the Spring Shell Project?</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="addon-command-annotations/slides/16">
<h1>Spring Shell</h1>

<ul>
<li>A Shell programming interface for your own, Spring-based apps</li>
<li>NOT OSGi based</li>
<li>Turns out, you're learning it</li>
<li>Uses <code>@CliCommand</code>, <code>@CliOption</code>, shell converters are the same</li>
<li>Extracted from Spring Roo</li>
<li>Now you know this too!</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="advanced-addons/slides/1">
<h1>Advanced add-ons</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/2">
<h1>Advanced add-on capabilities</h1>

<ul>
<li>Configure the Maven POM</li>
<li>Create, remove ITDs</li>
<li>Respond to file create, update, removal events</li>
<li>Modify existing Java class files</li>
<li>Copy files (transactionally)</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/3">
<h1>Configuring the Maven POM</h1>

<ul>
<li>Use the <code>ProjectManager</code> Roo Service bean</li>
<li>Can add, remove POM features</li>
<li>POM wrapper objects for common Maven objects

<ul>
<li><code>Dependency</code> - Maven dependencies</li>
<li><code>Plugin</code> - Maven build plug-ins</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/4">
<h1>Adding a dependency via the <code>ProjectManager</code></h1>

<pre class="sh_java"><code>// Direct API call
projectOperations.addDependency(
    projectOperations.getFocusedModuleName(),
    "cglib", "cglib-nodep", "2.2.2");    </code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/5">
<h1>Adding multiple dependencies</h1>

<pre class="sh_java"><code>Set&lt;Dependency&gt; dependencies = new HashSet&lt;Dependency&gt;();

// fill in from XML file, etc...

projectOperations.addDependencies(
    projectOperations.getFocusedModuleName(),
    dependencies);</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/6">
<p class="notes">You can also pass a file/path into getConfiguration</p>

<h1>Fetching dependencies from XML files</h1>

<pre class="sh_java"><code>String focusedModuleName = 
   projectOperations.getFocusedModuleName();

Element doc = XmlUtils.getConfiguration(getClass());

for (Element dependencyElement : 
     XmlUtils.findElements(
       "/configuration/project/dependencies/dependency", 
       doc)) {

  Dependency dependency = 
    new Dependency(dependencyElement);

  projectOperations.addDependency(
    focusedModuleName, dependency); 
}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/7">
<h1>Sample Configuration File</h1>

<pre class="sh_xml"><code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;
&lt;configuration&gt;
  &lt;project&gt;
    &lt;dependencies&gt;
      &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.batch&lt;/groupId&gt;
        &lt;artifactId&gt;
           spring-batch-admin-manager
        &lt;/artifactId&gt;
         &lt;version&gt;1.0.0.RELEASE&lt;/version&gt;
      &lt;/dependency&gt;
    &lt;/dependencies&gt;
  &lt;/project&gt;
&lt;/configuration&gt;</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/8">
<h1>Other Maven POM sections</h1>

<ul>
<li><p>You can add plug-ins, properties, dependency management</p></li>
<li><p>Issues</p>

<ul>
<li>The fetched POM wrapper objects are immutable</li>
<li>The constructors are long and a bit difficult</li>
<li>You may destroy existing user dependency/plugin settings</li>
<li>Consider a warning and a <code>--force</code> option for your users</li>
<li>Consider a <code>configuration.xml</code> file to simplify loading your new POM settings</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/9">
<h1>Roo Ninja Skills</h1>

<ul>
<li>Roo's typing and metadata system</li>
<li>Adding annotations to Java classes</li>
<li>Adding an ITD via detection of an annotation</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="advanced-addons/slides/10">
<h1>Roo's Typing and Metadata System</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/11">
<h1>Roo allows for Type Creation</h1>

<ul>
<li>Add-ons can modify types and ITDs</li>
<li>You need to provide:

<ul>
<li>A metadata object</li>
<li>A metadata provider object</li>
</ul></li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/12">
<h1>Refining a Java Type</h1>

<ul>
<li>Assumes a properly set-up add-on project</li>
<li>Metadata class could extend <code>AbstractItdTypeDetailsProvidingMetadataItem</code></li>
<li>Allows for both ITD and class manipulation</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/13">
<h1>In your meta-data class</h1>

<pre class="sh_java"><code>protected AddonsMetadata(
  String identifier, JavaType aspectName, 
  PhysicalTypeMetadata governorPhysicalTypeMetadata) {

  super(identifier, aspectName, 
        governorPhysicalTypeMetadata);

itdTypeDetails = builder.build();
if (isValid()) {
    ensureGovernorExtends(
      new JavaType("java.lang.Thread"));
    ensureGovernorImplements(
      new JavaType("java.io.Serializable"));
    buildItd();
}</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/14">
<h1>Adding ITD methods</h1>

<ul>
<li>Use the <code>MethodMetadataBuilder</code> to build  methods</li>
<li>Add the builder you've created with <code>builder.addMethod</code></li>
<li>These methods get built into the Java class, not the ITD</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/15">
<h1>Example ITD Method Builder</h1>

<pre class="sh_java"><code>    private MethodMetadataBuilder createThreadSpawner() {
      final InvocableMemberBodyBuilder bodyBuilder = 
        new InvocableMemberBodyBuilder();

      bodyBuilder.appendFormalLine(
        "System.out.println(\"invoking thread!\");");
      bodyBuilder.appendFormalLine(
        "new Thread().start(this);");
      bodyBuilder.appendFormalLine(
        "System.out.println(\"thread spawned!\");");

  ...</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/16">
<h1>Example ITD Method Builder - returning the result</h1>

<pre class="sh_java"><code>  ...

      return new MethodMetadataBuilder(
          getId(),
          Modifier.PUBLIC,
          new JavaSymbolName("sayHello"),
          JavaType.VOID_PRIMITIVE,
          bodyBuilder);
    }</code></pre>

<ul>
<li>How do we call this?</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/17">
<h1>The ITD Metadata's constructor</h1>

<pre class="sh_java"><code>protected AsyncActionMetadata(...) {
  super(identifier, aspectName, 
    governorPhysicalTypeMetadata);

  itdTypeDetails = builder.build();
  if (isValid()) {
    ...
  }</code></pre>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/18">
<h1>How to add the ITD</h1>

<pre class="sh_java"><code>if (isValid()) {
    ensureGovernorImplements(
      new JavaType("java.lang.Runnable"));

    JavaType physicalType = 
      governorPhysicalTypeMetadata.getType();

    MethodMetadataBuilder threadRunMethodBuilder = 
        createThreadRunnerMethod(physicalType);

    builder.addMethod(threadSpawnerBuilder);
    buildItd();
  }     </code></pre>

<ul>
<li>Just add it as a builder </li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="advanced-addons/slides/19">
<h1>Type management in Roo is a huge topic</h1>

<ul>
<li>Roo has a rich set of classes for manipulating types, ITDs</li>
<li>Way beyond the scope of this talk</li>
<li>Not documented except via JavaDocs</li>
<li>Best to read the source code, experiment</li>
<li>Any suggestions submit as JIRAs</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="conclusion/slides/1">
<h1>Wrap-up</h1>
</div>
</div><div class="slide" data-transition="none"><div class="content" ref="conclusion/slides/2">
<h1>Roo add-ons can do almost anything</h1>

<ul>
<li>Copy files</li>
<li>Install dependencies</li>
<li>Modify the POM file</li>
<li>Configure / write XML</li>
<li>Create / modify Java code</li>
<li>Add/Remove/Manipulate ITDs</li>
</ul>
</div>
</div><div class="slide" data-transition="none"><div class="content center" ref="conclusion/slides/3">
<h1>Questions</h1>

<ul>
<li>Twitter: @krimple</li>
<li>Blog: http://rimple.com</li>
<li>Emerging Tech site: http://emergingtech.chariotsolutions.com</li>
</ul>
</div>
</div></div>
<div id="pauseScreen">
  
</div>

</body>
</html>
